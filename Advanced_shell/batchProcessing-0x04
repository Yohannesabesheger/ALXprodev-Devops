#!/bin/bash

# Create the output directory if it doesn't exist
mkdir -p pokemon_data

# Clear error log
: > pokemon_data/errors.log

# List of Pokémon
pokemons=(bulbasaur ivysaur venusaur charmander charmeleon)

# Function to fetch data
fetch_pokemon() {
  local name="$1"
  echo "Fetching data for $name..."

  if curl -s --fail "https://pokeapi.co/api/v2/pokemon/$name" -o "pokemon_data/${name}.json"; then
    echo "Saved data to pokemon_data/${name}.json ✅"
  else
    echo "❌ Failed to fetch $name" | tee -a pokemon_data/errors.log
  fi
}

# Export function for subshell use (if needed by parallel or xargs)
export -f fetch_pokemon

# Fetch each Pokémon in background
for name in "${pokemons[@]}"; do
  fetch_pokemon "$name" &
done

# Wait for all background jobs to finish
wait

echo "✅ All fetch operations completed."
